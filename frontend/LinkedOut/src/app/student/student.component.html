<section>
  <h2>Estudantes</h2>

  <ng-container *ngIf="authService.hasRole('ADMIN')">
    <div class="filtros">
      <input type="text" [(ngModel)]="filtroCurso" placeholder="Filtrar por curso" />
      <input type="number" [(ngModel)]="periodoMin" placeholder="Período mínimo" />
      <input type="number" [(ngModel)]="periodoMax" placeholder="Período máximo" />
    </div>

    <button class="novo-btn" (click)="abrirFormularioCadastro()" *ngIf="!mostrarFormulario">Cadastrar Novo Estudante</button>

    <ul *ngIf="estudantesFiltrados.length > 0">
      <li *ngFor="let estudante of estudantesFiltrados">
        <div class="info-estudante">
          <strong>{{ estudante.nomeCompleto }}</strong>
          <span>{{ estudante.curso }} ({{ estudante.periodoAtual }}º período)</span>
        </div>
        <div class="acoes">
          <button (click)="editarEstudante(estudante)">Editar</button>
          <button (click)="excluirEstudante(estudante.id)">Excluir</button>
        </div>
      </li>
    </ul>
    <p *ngIf="estudantes.length > 0 && estudantesFiltrados.length === 0">Nenhum estudante encontrado com os filtros.</p>
    <p *ngIf="estudantes.length === 0">Nenhum estudante cadastrado no sistema.</p>
  </ng-container>

  <ng-container *ngIf="authService.hasRole('STUDENT') && !authService.hasRole('ADMIN')">
    <div *ngIf="estudantes.length > 0; else noProfileUser">
      <h3>Seu Perfil de Estudante</h3>
      <ul>
        <li *ngFor="let estudante of estudantes">
          <div class="info-estudante">
            <strong>{{ estudante.nomeCompleto }}</strong>
            <span>{{ estudante.curso }} ({{ estudante.periodoAtual }}º período)</span>
          </div>
          <div class="acoes">
            <button (click)="editarEstudante(estudante)">Editar Meu Perfil</button>
            <button (click)="excluirEstudante(estudante.id)">Excluir Meu Perfil</button>
          </div>
        </li>
      </ul>
    </div>
  </ng-container>

  <ng-template #noProfileUser>
    <div *ngIf="authService.hasRole('USER') && !authService.hasRole('ADMIN')">
      <p>Você ainda não possui um perfil de estudante.</p>
      <button class="novo-btn" (click)="abrirFormularioCadastro()" *ngIf="!mostrarFormulario">Criar Meu Perfil</button>
    </div>
  </ng-template>

  <section *ngIf="mostrarFormulario">
    <h3>{{ estudanteEditando ? 'Editar Perfil' : 'Cadastrar Perfil' }} de Estudante</h3>
    <form [formGroup]="formEstudante" (ngSubmit)="onSubmit()">

      <div *ngIf="authService.hasRole('ADMIN') && !estudanteEditando">
        <label for="usuario">Selecione o Usuário:</label>
        <select id="usuario" formControlName="userId">
          <option [ngValue]="null" disabled>Escolha um usuário</option>
          <option *ngFor="let user of usuarios" [value]="user.id">{{ user.nome }} ({{ user.id }})</option>
        </select>
      </div>

      <input type="text" formControlName="nomeCompleto" placeholder="Nome Completo" />
      <input type="date" formControlName="dataNascimento" />
      <input type="text" formControlName="cpf" placeholder="CPF" />
      <input type="text" formControlName="telefone" placeholder="Telefone" />
      <input type="text" formControlName="curso" placeholder="Curso" />
      <input type="number" formControlName="periodoAtual" placeholder="Período Atual" />
      <textarea formControlName="resumoAcademico" placeholder="Resumo Acadêmico"></textarea>

      <div class="botoes-formulario">
        <button type="submit" [disabled]="formEstudante.invalid">
          {{ estudanteEditando ? 'Salvar Alterações' : 'Cadastrar Perfil' }}
        </button>
        <button type="button" (click)="cancelarCadastro()">Cancelar</button>
      </div>
    </form>
  </section>
</section>
